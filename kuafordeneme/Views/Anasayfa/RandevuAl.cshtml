@{
    ViewData["Title"] = "Randevu Al";
}

<div class="container mt-5">
    <h2 class="text-center mb-4">Randevu Al</h2>

    <div class="row justify-content-center">
        <div class="col-md-6">
            <div class="card">
                <div class="card-body">
                    <form method="post" action="/Anasayfa/RandevuAl">
                        <!-- Ad Soyad -->
                        <div class="mb-3">
                            <label for="adSoyad" class="form-label">Ad Soyad:</label>
                            <input type="text" class="form-control" id="adSoyad" name="adSoyad" required>
                        </div>

                        <!-- İşlem Seçimi -->
                        <div class="mb-3">
                            <label for="islem" class="form-label">İşlem Seçin:</label>
                            <select class="form-select" id="islem" name="islemID" required onchange="getCalisanlar()">
                                <option value="">İşlem Seçin</option>
                                @foreach (var islem in (List<Islemler>)ViewBag.Islemler)
                                {
                                    <option value="@islem.IslemID">@islem.IslemAd</option>
                                }
                            </select>
                        </div>

                        <!-- Çalışan Seçimi -->
                        <div class="mb-3">
                            <label for="calisan" class="form-label">Çalışan Seçin:</label>
                            <select class="form-select" id="calisan" name="calisanID" required>
                                <option value="">Çalışan Seçin</option>
                            </select>
                        </div>

                        <!-- Randevu Zamanı -->
                        <div class="mb-3">
                            <label for="randevuZamani" class="form-label">Randevu Zamanı:</label>
                            <input type="datetime-local" class="form-control" id="randevuZamani" name="randevuZamani" required>
                        </div>

                        <!-- Submit Button -->
                        <div class="mb-3">
                            <button type="submit" class="btn btn-primary w-100">Randevu Al</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

@if (TempData["Error"] != null)
{
    <div class="alert alert-danger">
        @TempData["Error"]
    </div>
}

@if (TempData["Success"] != null)
{
    <div class="alert alert-success">
        @TempData["Success"]
    </div>
}

@section Scripts {
    <script>
        function getCalisanlar() {
            const islemID = document.getElementById('islem').value;

            fetch(`/Anasayfa/GetCalisanlar?islemID=${islemID}`)
                .then(response => response.json())
                .then(data => {
                    const calisanSelect = document.getElementById('calisan');
                    calisanSelect.innerHTML = '<option value="">Çalışan Seçin</option>';

                    data.forEach(calisan => {
                        const option = document.createElement('option');
                        option.value = calisan.calisanID;
                        option.textContent = `${calisan.calisanAd} (${calisan.musaitlik ? 'Müsait' : 'Meşgul'})`;
                        calisanSelect.appendChild(option);
                    });
                })
                .catch(error => {
                    console.error('Hata:', error);
                });
        }
    </script>
}
